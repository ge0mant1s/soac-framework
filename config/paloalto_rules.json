[
  {
    "id": "PALOALTO-001",
    "use_case": "Intrusion",
    "detection_rule": "Hosts repeatedly connecting to the same external IP (possible beaconing/C2).",
    "incident_rule": "Pattern sustained across multiple hosts or windows; verify with EDR/DNS intel.",
    "severity": "High",
    "mitre_tactic": "Command and Control",
    "mitre_technique": "T1071.001 (Web Protocols)",
    "category": "Beaconing",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| groupBy([event.source.ip, event.destination.ip, event.destination.port],\n          function=count(as=\"sessions\"),\n          limit=100000)\n| sessions >= 200\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-002",
    "use_case": "Attack Against Data",
    "detection_rule": "Large outbound bytes to the same external ASN or domain group (exfiltration risk).",
    "incident_rule": ">= 1 GB to non-corporate ASN or many destinations; align with DLP alerts.",
    "severity": "High",
    "mitre_tactic": "Exfiltration",
    "mitre_technique": "T1041 (Exfiltration Over C2 Channel)",
    "category": "Data Exfiltration",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| groupBy([event.source.ip, event.destination.as.organization.name],\n          function=sum(event.source.bytes, as=\"bytes_out\"),\n          limit=100000)\n| bytes_out >= 1000000000\n| sort(field=bytes_out, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-003",
    "use_case": "Intrusion",
    "detection_rule": "Traffic to rare destination countries for the org.",
    "incident_rule": "Multiple sources to the same rare country or risky ASN.",
    "severity": "Medium-High",
    "mitre_tactic": "Command and Control",
    "mitre_technique": "T1071.001 (Web Protocols)",
    "category": "Geo Anomaly",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| event.destination.geo.country_name !~ /(Spain|Switzerland|Germany|France|United Kingdom|United States)/i\n| groupBy([event.destination.geo.country_name, event.source.ip],\n          function=count(as=\"sessions\"),\n          limit=100000)\n| sessions >= 50\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-004",
    "use_case": "Misconfiguration / DoS",
    "detection_rule": "Spike in TCP reset end reasons (e.g., tcp-rst-from-client/server).",
    "incident_rule": "Burst tied to a destination ASN or a single rule; investigate reachability/attack.",
    "severity": "Medium",
    "mitre_tactic": "Impact",
    "mitre_technique": "T1498 (Network DoS)",
    "category": "Stability Issues",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| groupBy([event.panw.panos.endreason, event.destination.as.organization.name],\n          function=count(as=\"events\"),\n          limit=100000)\n| events >= 200\n| sort(field=events, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-005",
    "use_case": "Intrusion",
    "detection_rule": "SSL traffic on uncommon destination ports (not 443/8443/9443).",
    "incident_rule": "Many hosts toward the same uncommon port; potential covert tunnel.",
    "severity": "Medium-High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1090 (Proxy)",
    "category": "Tunneling",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| event.network.application = ssl\n| (event.destination.port !in [443, 8443, 9443])\n| groupBy([event.source.ip, event.destination.ip, event.destination.port],\n          function=count(as=\"sessions\"),\n          limit=100000)\n| sessions >= 20\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-006",
    "use_case": "Misconfiguration / Poor Security",
    "detection_rule": "Unknown apps or high risk level (>=4) permitted by policy.",
    "incident_rule": "Same rule allows large volume; tighten rulebase or enable App-ID controls.",
    "severity": "High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1562 (Impair Defenses)",
    "category": "Policy Gaps",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| (event.network.application =~ /^unknown-/i or event.panw.panos.application.risk_level >= 4)\n| groupBy([event.rule.name, event.network.application],\n          function=count(as=\"hits\"),\n          limit=100000)\n| hits >= 100\n| sort(field=hits, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-007",
    "use_case": "Malware",
    "detection_rule": "Application characteristics include 'used-by-malware' but traffic is allowed.",
    "incident_rule": "Multiple sources or large byte totals; correlate with endpoint alerts.",
    "severity": "High",
    "mitre_tactic": "Command and Control",
    "mitre_technique": "T1071 (Application Layer)",
    "category": "Malicious App Traits",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| event.panw.panos.application.characteristics =~ /used-by-malware/i\n| groupBy([event.source.ip, event.network.application],\n          function=[count(as=\"sessions\"), sum(event.network.bytes, as=\"bytes_total\")],\n          limit=100000)\n| sessions >= 10\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-008",
    "use_case": "Intrusion / Evasion",
    "detection_rule": "Encrypted-tunnel subcategory heading to external ASNs.",
    "incident_rule": "High volume or many sources to the same ASN.",
    "severity": "Medium-High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1090 (Proxy)",
    "category": "Encrypted Tunnels",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| event.panw.panos.application.sub_category = encrypted-tunnel\n| groupBy([event.destination.as.organization.name, event.source.ip],\n          function=count(as=\"sessions\"),\n          limit=100000)\n| sessions >= 30\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-009",
    "use_case": "Intrusion",
    "detection_rule": "Allowed traffic where egress zone is not INTERNET (potential lateral movement).",
    "incident_rule": "High volume from a single source or to sensitive internal IPs.",
    "severity": "Medium",
    "mitre_tactic": "Lateral Movement",
    "mitre_technique": "T1021 (Remote Services)",
    "category": "Lateral Movement",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| event.observer.egress.zone !~ /INTERNET/i\n| groupBy([event.source.ip, event.destination.ip, event.observer.egress.zone],\n          function=count(as=\"sessions\"),\n          limit=100000)\n| sessions >= 50\n| sort(field=sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-010",
    "use_case": "Intrusion",
    "detection_rule": "After-hours surge of allowed sessions by rule.",
    "incident_rule": "Repeated nights or high-risk apps involved.",
    "severity": "Medium-High",
    "mitre_tactic": "Collection / C2",
    "mitre_technique": "T1071 (Application Layer)",
    "category": "Off-hours Activity",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| eval(hour = time:hour(@timestamp))\n| (hour < 7 or hour > 20)\n| groupBy([event.rule.name],\n          function=count(as=\"offhour_sessions\"),\n          limit=100000)\n| offhour_sessions >= 200\n| sort(field=offhour_sessions, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-011",
    "use_case": "Intrusion / Evasion",
    "detection_rule": "Single internal source uses many distinct NAT source ports (port hopping).",
    "incident_rule": "Correlate with geo/risky ASN anomalies or beaconing detections.",
    "severity": "Medium",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1090 (Proxy)",
    "category": "NAT Anomaly",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| groupBy([event.source.ip, event.source.nat.port], function=count(as=\"per_port\"), limit=100000)\n| groupBy([event.source.ip], function=[count(as=\"distinct_nat_ports\"), sum(per_port, as=\"sessions\")], limit=100000)\n| distinct_nat_ports >= 200\n| sort(field=distinct_nat_ports, order=desc, limit=2000)",
    "source": "PaloAlto"
  },
  {
    "id": "PALOALTO-012",
    "use_case": "Misconfiguration / Governance",
    "detection_rule": "Identify rules allowing the most bytes for review and tuning.",
    "incident_rule": "Large sudden changes or unexpected top talkers.",
    "severity": "Low-Medium",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1562 (Impair Defenses)",
    "category": "Rule Tuning",
    "query": "#repo = paloalto\n| event.panw.panos.action = allow\n| groupBy([event.rule.name],\n          function=sum(event.network.bytes, as=\"bytes_total\"),\n          limit=100000)\n| sort(field=bytes_total, order=desc, limit=2000)",
    "source": "PaloAlto"
  }
]