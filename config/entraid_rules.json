[
  {
    "id": "ENTRAID-001",
    "use_case": "Intrusion",
    "detection_rule": "Many authentication failures per account (possible brute-force or credential stuffing).",
    "incident_rule": "Burst from same IP and subsequent success; correlate with Umbrella/PAN EDR.",
    "severity": "High",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110 (Brute Force)",
    "category": "Account Abuse",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([user.name, source.ip], function=count(as=\"fails\"), limit=100000)\n| fails >= 15\n| sort(field=fails, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-002",
    "use_case": "Intrusion",
    "detection_rule": "One IP failing across many users (password spraying).",
    "incident_rule": "\u226510 users and \u226530 total fails from one IP in a window.",
    "severity": "High",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110.003 (Password Spraying)",
    "category": "Account Abuse",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([source.ip, user.name], function=count(as=\"per_user\"), limit=100000)\n| groupBy([source.ip], function=[count(as=\"users_targeted\"), sum(per_user, as=\"total_fails\")], limit=100000)\n| users_targeted >= 10 and total_fails >= 30\n| sort(field=users_targeted, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-003",
    "use_case": "Intrusion",
    "detection_rule": "Success following a burst of failures (possible account takeover).",
    "incident_rule": "Success within 30 minutes after \u22658 failures; pivot to device and app used.",
    "severity": "High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1078 (Valid Accounts)",
    "category": "Account Takeover",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([user.name], function=[count(as=\"fails\"), max(@timestamp, as=\"last_fail_ts\")], limit=100000)\n| fails >= 8\n| join(\n  {\n    #event.module=entraid\n    | event.dataset = entraid.signin\n    | event.outcome = success\n    | select([@timestamp, user.name, source.ip])\n  },\n  field=user.name,\n  include=[@timestamp, user.name, source.ip]\n)\n| eval(success_time = @timestamp)\n| eval(delta_ms = success_time - last_fail_ts)\n| delta_ms <= 1800000\n| sort(field=fails, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-004",
    "use_case": "Intrusion",
    "detection_rule": "User signs in from multiple countries too quickly (geo-velocity).",
    "incident_rule": "Two or more distinct countries for the same user in a short time window.",
    "severity": "High",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110 / (Geo Anomaly)",
    "category": "Geo Anomaly",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| groupBy([user.name, source.geo.country_name, source.ip], function=min(@timestamp, as=\"first_seen\"), limit=100000)\n| groupBy([user.name], function=count(as=\"geo_hops\"), limit=100000)\n| geo_hops >= 2\n| sort(field=geo_hops, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-005",
    "use_case": "Misconfiguration / Poor Security",
    "detection_rule": "Legacy/basic/IMAP/POP/ActiveSync or non-modern auth clients used.",
    "incident_rule": "Repeated usage by same user or many users; block or enforce CA.",
    "severity": "Medium-High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1556 (Modify Auth Process)",
    "category": "Legacy Auth",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.clientAppUsed =~ /(Legacy|Basic|IMAP|POP|ActiveSync)/i\n| groupBy([user.name, Vendor.properties.clientAppUsed], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-006",
    "use_case": "Intrusion",
    "detection_rule": "Sign-ins with risk level flagged (not 'none').",
    "incident_rule": "Concentrated on single user/IP or app; trigger IR workflow.",
    "severity": "High",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110 (Risky Sign-in)",
    "category": "Risk Flags",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.riskLevelDuringSignIn !~ /none/i\n| groupBy([user.name, Vendor.properties.riskLevelDuringSignIn], function=count(as=\"events\"), limit=100000)\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-007",
    "use_case": "Misconfiguration / Policy",
    "detection_rule": "Conditional Access status = failure/reportOnlyFailure.",
    "incident_rule": "Investigate policy gaps and enforce or tune rules.",
    "severity": "Medium-High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1556 (Policy Weakness)",
    "category": "Policy Gaps",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.conditionalAccessStatus =~ /(failure|reportOnlyFailure)/i\n| groupBy([user.name, Vendor.properties.conditionalAccessStatus], function=count(as=\"hits\"), limit=100000)\n| sort(field=hits, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-008",
    "use_case": "Intrusion",
    "detection_rule": "MFA satisfied by a token claim unexpectedly.",
    "incident_rule": "Multiple occurrences per user; check session token protection & CAE.",
    "severity": "High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1556.006 (Forge Web Tokens)",
    "category": "MFA Bypass",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.status.additionalDetails =~ /MFA requirement satisfied by claim/i\n| groupBy([user.name, source.ip, Vendor.properties.clientAppUsed], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-009",
    "use_case": "Misconfiguration / Poor Security",
    "detection_rule": "Unmanaged/non-compliant device succeeded in sign-in.",
    "incident_rule": "Sustained successes from unmanaged devices; escalate enforcement.",
    "severity": "Medium-High",
    "mitre_tactic": "Initial Access",
    "mitre_technique": "T1078 (Valid Accounts)",
    "category": "Device Trust",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.deviceDetail.trustType !~ /(Compliant|Hybrid Azure AD joined|Azure AD joined)/i\n| event.outcome = success\n| groupBy([user.name, Vendor.properties.deviceDetail.displayName, Vendor.properties.deviceDetail.trustType], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-010",
    "use_case": "Intrusion",
    "detection_rule": "Successful sign-ins outside business hours.",
    "incident_rule": "Repeated off-hours by same user, new locations, or risky clients.",
    "severity": "Medium",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110 (After-hours)",
    "category": "Off-hours",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| eval(hour = time:hour(@timestamp))\n| (hour < 7 or hour > 20)\n| groupBy([user.name, source.ip], function=count(as=\"offhour_signins\"), limit=100000)\n| offhour_signins >= 5\n| sort(field=offhour_signins, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-011",
    "use_case": "Supply Chain Attack / Intrusion",
    "detection_rule": "Non-standard appDisplayName used for sign-ins.",
    "incident_rule": "\u22653 successes to unusual app; verify consent & permissions.",
    "severity": "Medium-High",
    "mitre_tactic": "Initial Access",
    "mitre_technique": "T1528 (Steal App Token)",
    "category": "App Consent",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.appDisplayName !~ /(Microsoft|Office|Teams|Exchange|SharePoint|Edge)/i\n| event.outcome = success\n| groupBy([Vendor.properties.appDisplayName, user.name], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-012",
    "use_case": "Misconfiguration / Intrusion",
    "detection_rule": "Named network policy context but public IP outside private ranges.",
    "incident_rule": "\u22653 events per user/IP; check CA network lists/VPN.",
    "severity": "Medium-High",
    "mitre_tactic": "Defense Evasion",
    "mitre_technique": "T1562 (Impair Defenses)",
    "category": "Network Policy",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.networkLocationDetails[0].networkType = namedNetwork\n| source.ip !~ /^10\\./ and source.ip !~ /^192\\.168\\./ and source.ip !~ /^172\\.(1[6-9]|2[0-9]|3[0-1])\\./\n| groupBy([user.name, source.ip], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-013",
    "use_case": "Misconfiguration / Availability",
    "detection_rule": "NonInteractiveUserSignInLogs volume surge (token refresh/service acct).",
    "incident_rule": "\u2265500 token events per user/client; validate app health and scopes.",
    "severity": "Medium",
    "mitre_tactic": "Persistence",
    "mitre_technique": "T1136 / T1098 (Service)",
    "category": "Token Storm",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.category = NonInteractiveUserSignInLogs\n| groupBy([user.name, Vendor.properties.clientAppUsed], function=count(as=\"token_events\"), limit=100000)\n| token_events >= 500\n| sort(field=token_events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-014",
    "use_case": "Intrusion",
    "detection_rule": "Successful sign-ins from countries outside allow-list.",
    "incident_rule": "\u22652 hits; verify travel or enforce CA location policy.",
    "severity": "Medium-High",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1110 (Geo)",
    "category": "Geo Anomaly",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| source.geo.country_name !~ /(Switzerland|Germany|France|Spain|United Kingdom|United States)/i\n| groupBy([user.name, source.geo.country_name, source.ip], function=count(as=\"hits\"), limit=100000)\n| hits >= 2\n| sort(field=hits, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-015",
    "use_case": "Misconfiguration / Poor Security",
    "detection_rule": "Legacy TLS flag observed for sign-in processing details.",
    "incident_rule": "Any occurrence should be triaged; inventory old agents/browsers.",
    "severity": "Medium",
    "mitre_tactic": "Credential Access",
    "mitre_technique": "T1556 (Auth Weakness)",
    "category": "Legacy TLS",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.authenticationProcessingDetails[0].key = \"Legacy TLS (TLS 1.0, 1.1, 3DES)\"\n| Vendor.properties.authenticationProcessingDetails[0].value =~ /True/i\n| groupBy([user.name, user_agent.original], function=count(as=\"events\"), limit=100000)\n| events >= 1\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  },
  {
    "id": "ENTRAID-016",
    "use_case": "Supply Chain Attack / Social Engineering",
    "detection_rule": "Guest/External users show elevated sign-in activity.",
    "incident_rule": "\u22655 events per guest from one IP; validate sponsorship & CA.",
    "severity": "Medium-High",
    "mitre_tactic": "Initial Access",
    "mitre_technique": "T1078 (Valid Accounts)",
    "category": "Guest Access",
    "query": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.userType =~ /Guest|External/i\n| groupBy([user.name, source.ip], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "source": "EntraID"
  }
]