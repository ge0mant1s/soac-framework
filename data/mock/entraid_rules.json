[
  {
    "id": "EA-001",
    "useCase": "Intrusion",
    "detectionRule": "Many authentication failures per account (possible brute-force or credential stuffing).",
    "incidentRule": "Burst from same IP and subsequent success; correlate with Umbrella/PAN EDR.",
    "severity": "High",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110 (Brute Force)",
    "category": "Account Abuse",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([user.name, source.ip], function=count(as=\"fails\"), limit=100000)\n| fails >= 15\n| sort(field=fails, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-25T21:38:22.534800",
    "lastModified": "2025-11-12T21:38:22.534805"
  },
  {
    "id": "EA-002",
    "useCase": "Intrusion",
    "detectionRule": "One IP failing across many users (password spraying).",
    "incidentRule": "\u226510 users and \u226530 total fails from one IP in a window.",
    "severity": "High",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110.003 (Password Spraying)",
    "category": "Account Abuse",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([source.ip, user.name], function=count(as=\"per_user\"), limit=100000)\n| groupBy([source.ip], function=[count(as=\"users_targeted\"), sum(per_user, as=\"total_fails\")], limit=100000)\n| users_targeted >= 10 and total_fails >= 30\n| sort(field=users_targeted, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-11-11T21:38:22.534841",
    "lastModified": "2025-11-12T21:38:22.534844"
  },
  {
    "id": "EA-003",
    "useCase": "Intrusion",
    "detectionRule": "Success following a burst of failures (possible account takeover).",
    "incidentRule": "Success within 30 minutes after \u22658 failures; pivot to device and app used.",
    "severity": "High",
    "mitreTactic": "Defense Evasion",
    "mitreTechnique": "T1078 (Valid Accounts)",
    "category": "Account Takeover",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = failure\n| groupBy([user.name], function=[count(as=\"fails\"), max(@timestamp, as=\"last_fail_ts\")], limit=100000)\n| fails >= 8\n| join(\n  {\n    #event.module=entraid\n    | event.dataset = entraid.signin\n    | event.outcome = success\n    | select([@timestamp, user.name, source.ip])\n  },\n  field=user.name,\n  include=[@timestamp, user.name, source.ip]\n)\n| eval(success_time = @timestamp)\n| eval(delta_ms = success_time - last_fail_ts)\n| delta_ms <= 1800000\n| sort(field=fails, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-26T21:38:22.534875",
    "lastModified": "2025-11-12T21:38:22.534878"
  },
  {
    "id": "EA-004",
    "useCase": "Intrusion",
    "detectionRule": "User signs in from multiple countries too quickly (geo-velocity).",
    "incidentRule": "Two or more distinct countries for the same user in a short time window.",
    "severity": "High",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110 / (Geo Anomaly)",
    "category": "Geo Anomaly",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| groupBy([user.name, source.geo.country_name, source.ip], function=min(@timestamp, as=\"first_seen\"), limit=100000)\n| groupBy([user.name], function=count(as=\"geo_hops\"), limit=100000)\n| geo_hops >= 2\n| sort(field=geo_hops, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-20T21:38:22.534908",
    "lastModified": "2025-11-12T21:38:22.534911"
  },
  {
    "id": "EA-005",
    "useCase": "Misconfiguration / Poor Security",
    "detectionRule": "Legacy/basic/IMAP/POP/ActiveSync or non-modern auth clients used.",
    "incidentRule": "Repeated usage by same user or many users; block or enforce CA.",
    "severity": "Medium-High",
    "mitreTactic": "Defense Evasion",
    "mitreTechnique": "T1556 (Modify Auth Process)",
    "category": "Legacy Auth",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.clientAppUsed =~ /(Legacy|Basic|IMAP|POP|ActiveSync)/i\n| groupBy([user.name, Vendor.properties.clientAppUsed], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-11-06T21:38:22.534940",
    "lastModified": "2025-11-12T21:38:22.534943"
  },
  {
    "id": "EA-006",
    "useCase": "Intrusion",
    "detectionRule": "Sign-ins with risk level flagged (not 'none').",
    "incidentRule": "Concentrated on single user/IP or app; trigger IR workflow.",
    "severity": "High",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110 (Risky Sign-in)",
    "category": "Risk Flags",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.riskLevelDuringSignIn !~ /none/i\n| groupBy([user.name, Vendor.properties.riskLevelDuringSignIn], function=count(as=\"events\"), limit=100000)\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-11-08T21:38:22.534978",
    "lastModified": "2025-11-12T21:38:22.534980"
  },
  {
    "id": "EA-007",
    "useCase": "Misconfiguration / Policy",
    "detectionRule": "Conditional Access status = failure/reportOnlyFailure.",
    "incidentRule": "Investigate policy gaps and enforce or tune rules.",
    "severity": "Medium-High",
    "mitreTactic": "Defense Evasion",
    "mitreTechnique": "T1556 (Policy Weakness)",
    "category": "Policy Gaps",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.conditionalAccessStatus =~ /(failure|reportOnlyFailure)/i\n| groupBy([user.name, Vendor.properties.conditionalAccessStatus], function=count(as=\"hits\"), limit=100000)\n| sort(field=hits, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-11-05T21:38:22.535010",
    "lastModified": "2025-11-12T21:38:22.535012"
  },
  {
    "id": "EA-008",
    "useCase": "Intrusion",
    "detectionRule": "MFA satisfied by a token claim unexpectedly.",
    "incidentRule": "Multiple occurrences per user; check session token protection & CAE.",
    "severity": "High",
    "mitreTactic": "Defense Evasion",
    "mitreTechnique": "T1556.006 (Forge Web Tokens)",
    "category": "MFA Bypass",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.status.additionalDetails =~ /MFA requirement satisfied by claim/i\n| groupBy([user.name, source.ip, Vendor.properties.clientAppUsed], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-11-04T21:38:22.535040",
    "lastModified": "2025-11-12T21:38:22.535043"
  },
  {
    "id": "EA-009",
    "useCase": "Misconfiguration / Poor Security",
    "detectionRule": "Unmanaged/non-compliant device succeeded in sign-in.",
    "incidentRule": "Sustained successes from unmanaged devices; escalate enforcement.",
    "severity": "Medium-High",
    "mitreTactic": "Initial Access",
    "mitreTechnique": "T1078 (Valid Accounts)",
    "category": "Device Trust",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.deviceDetail.trustType !~ /(Compliant|Hybrid Azure AD joined|Azure AD joined)/i\n| event.outcome = success\n| groupBy([user.name, Vendor.properties.deviceDetail.displayName, Vendor.properties.deviceDetail.trustType], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-15T21:38:22.535072",
    "lastModified": "2025-11-12T21:38:22.535074"
  },
  {
    "id": "EA-010",
    "useCase": "Intrusion",
    "detectionRule": "Successful sign-ins outside business hours.",
    "incidentRule": "Repeated off-hours by same user, new locations, or risky clients.",
    "severity": "Medium",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110 (After-hours)",
    "category": "Off-hours",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| eval(hour = time:hour(@timestamp))\n| (hour < 7 or hour > 20)\n| groupBy([user.name, source.ip], function=count(as=\"offhour_signins\"), limit=100000)\n| offhour_signins >= 5\n| sort(field=offhour_signins, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-16T21:38:22.535104",
    "lastModified": "2025-11-12T21:38:22.535107"
  },
  {
    "id": "EA-011",
    "useCase": "Supply Chain Attack / Intrusion",
    "detectionRule": "Non-standard appDisplayName used for sign-ins.",
    "incidentRule": "\u22653 successes to unusual app; verify consent & permissions.",
    "severity": "Medium-High",
    "mitreTactic": "Initial Access",
    "mitreTechnique": "T1528 (Steal App Token)",
    "category": "App Consent",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.appDisplayName !~ /(Microsoft|Office|Teams|Exchange|SharePoint|Edge)/i\n| event.outcome = success\n| groupBy([Vendor.properties.appDisplayName, user.name], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-23T21:38:22.535137",
    "lastModified": "2025-11-12T21:38:22.535139"
  },
  {
    "id": "EA-012",
    "useCase": "Misconfiguration / Intrusion",
    "detectionRule": "Named network policy context but public IP outside private ranges.",
    "incidentRule": "\u22653 events per user/IP; check CA network lists/VPN.",
    "severity": "Medium-High",
    "mitreTactic": "Defense Evasion",
    "mitreTechnique": "T1562 (Impair Defenses)",
    "category": "Network Policy",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.networkLocationDetails[0].networkType = namedNetwork\n| source.ip !~ /^10\\./ and source.ip !~ /^192\\.168\\./ and source.ip !~ /^172\\.(1[6-9]|2[0-9]|3[0-1])\\./\n| groupBy([user.name, source.ip], function=count(as=\"events\"), limit=100000)\n| events >= 3\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-27T21:38:22.535169",
    "lastModified": "2025-11-12T21:38:22.535171"
  },
  {
    "id": "EA-013",
    "useCase": "Misconfiguration / Availability",
    "detectionRule": "NonInteractiveUserSignInLogs volume surge (token refresh/service acct).",
    "incidentRule": "\u2265500 token events per user/client; validate app health and scopes.",
    "severity": "Medium",
    "mitreTactic": "Persistence",
    "mitreTechnique": "T1136 / T1098 (Service)",
    "category": "Token Storm",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.category = NonInteractiveUserSignInLogs\n| groupBy([user.name, Vendor.properties.clientAppUsed], function=count(as=\"token_events\"), limit=100000)\n| token_events >= 500\n| sort(field=token_events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-26T21:38:22.535200",
    "lastModified": "2025-11-12T21:38:22.535203"
  },
  {
    "id": "EA-014",
    "useCase": "Intrusion",
    "detectionRule": "Successful sign-ins from countries outside allow-list.",
    "incidentRule": "\u22652 hits; verify travel or enforce CA location policy.",
    "severity": "Medium-High",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1110 (Geo)",
    "category": "Geo Anomaly",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| event.outcome = success\n| source.geo.country_name !~ /(Switzerland|Germany|France|Spain|United Kingdom|United States)/i\n| groupBy([user.name, source.geo.country_name, source.ip], function=count(as=\"hits\"), limit=100000)\n| hits >= 2\n| sort(field=hits, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-15T21:38:22.535231",
    "lastModified": "2025-11-12T21:38:22.535234"
  },
  {
    "id": "EA-015",
    "useCase": "Misconfiguration / Poor Security",
    "detectionRule": "Legacy TLS flag observed for sign-in processing details.",
    "incidentRule": "Any occurrence should be triaged; inventory old agents/browsers.",
    "severity": "Medium",
    "mitreTactic": "Credential Access",
    "mitreTechnique": "T1556 (Auth Weakness)",
    "category": "Legacy TLS",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.authenticationProcessingDetails[0].key = \"Legacy TLS (TLS 1.0, 1.1, 3DES)\"\n| Vendor.properties.authenticationProcessingDetails[0].value =~ /True/i\n| groupBy([user.name, user_agent.original], function=count(as=\"events\"), limit=100000)\n| events >= 1\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-24T21:38:22.535262",
    "lastModified": "2025-11-12T21:38:22.535264"
  },
  {
    "id": "EA-016",
    "useCase": "Supply Chain Attack / Social Engineering",
    "detectionRule": "Guest/External users show elevated sign-in activity.",
    "incidentRule": "\u22655 events per guest from one IP; validate sponsorship & CA.",
    "severity": "Medium-High",
    "mitreTactic": "Initial Access",
    "mitreTechnique": "T1078 (Valid Accounts)",
    "category": "Guest Access",
    "cqlQuery": "#event.module=entraid\n| event.dataset = entraid.signin\n| Vendor.properties.userType =~ /Guest|External/i\n| groupBy([user.name, source.ip], function=count(as=\"events\"), limit=100000)\n| events >= 5\n| sort(field=events, order=desc, limit=2000)",
    "enabled": true,
    "createdAt": "2025-10-22T21:38:22.535294",
    "lastModified": "2025-11-12T21:38:22.535297"
  }
]